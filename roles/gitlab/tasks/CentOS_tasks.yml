---
- assert:
    that: "ansible_distribution_major_version is version_compare('7', '>=')"
    msg: "CentOS version supported"
#- debug: var=ansible_distribution_major_version

- name: install CentOS7 packages
  package:
    name: "{{ item }}"
    state: present
  loop:
    - policycoreutils-python
    - openssh-server
    - perl
    - postfix
  when: ansible_distribution_major_version | int == 7

- name: install CentOS8 packages
  package:
    name: "{{ item }}"
    state: present
  loop:
    - policycoreutils
    - openssh-server
    - perl
    - postfix
  when: ansible_distribution_major_version | int == 8

- name: start postfix
  service:
    name: postfix
    enabled: true
    state: started

- name: start firewalld
  service:
    name: firewalld
    enabled: true
    state: started

# firewalld has migrated to the community posix collection 
# which can be installed with ansible-galaxy
#    ansible-galaxy collection install ansible.posix
# use command instead even if this isn't idempotent
- name: enable firewalld http and https
  command: firewall-cmd --permanent --add-service="{{ item }}"
  args:
    warn: no
  register: firewall
  loop:
    - http
    - https
#- debug: var=firewall

- name: reload firewalld
  command: firewall-cmd --reload
  args:
    warn: no
  register: reload
#- debug: var=reload
